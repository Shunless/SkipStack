function selectCell(e){var t=e.split("-")[0],r=e.split("-")[1];return $("#"+t+"-"+r)}function selectRow(e){for(var t=1,r=$("");7>=t;t++)r=r.add(selectCell(e+"-"+t));return r}function selectCol(e){for(var t=1,r=$("");13>=t;t++)r=r.add(selectCell(t+"-"+e));return r}function selectAreaComplimentary(e,t,r,i){for(;t+1>=e;e++)i=i.add(selectCell(r+"-"+e));return i}function selectArea(e,t){for(var r=$(""),i=Number(e.split("-")[0]),o=Number(e.split("-")[1]),l=Number(t.split("-")[0]),s=Number(t.split("-")[1])-1;l>=i;i++)r=selectAreaComplimentary(o,s,i,r);return r}function roundUp(e,t,r){return selectArea(e,t).wrapAll('<div class="'+r+'"/>'),$("."+r)}function flip(e,t){e.css("z-index",zIndex()),void 0===e.data("rotation")&&e.data("rotation",0);var r,i=e.data("rotation");return t?(r=180*Number(i)-180,i--):(r=180*Number(i)+180,i++),e.transition({perspective:"800px",rotateY:r+"deg"}),e.data("rotation",i),e}function hashId(){for(var e="",t="abcdefghijklmnopqrstuvwxyz",r=0;5>r;r++)e+=t.charAt(Math.floor(Math.random()*t.length));return e}function redGrid(e,t,r){return e.children(".cell").each(function(){$(this).css("top",Number($(this).css("top").split("px")[0])-t+"px"),$(this).css("left",Number($(this).css("left").split("px")[0])-r+"px")}),e}function deGrid(e,t,r){return e.children(".cell").each(function(){$(this).css("top",Number($(this).css("top").split("px")[0])+t+"px"),$(this).css("left",Number($(this).css("left").split("px")[0])+r+"px")}),e}function redArea(e,t,r){return e.css({top:Number($(e).css("top").split("px")[0])-t+"px",left:Number($(e).css("left").split("px")[0])-r+"px"}),e}function selectComplex(e,t,r,i){var o=gridToFlipCard(e,t,r),l=$(o.children(".front")),s=getCoords(e);return i.forEach(function(e){redArea($(e),Number(s[0]-1)*cellSize,Number(s[1]-1)*cellSize),l=l.append($(e))}),l.appendTo($("."+r+".front")),o}function createGame(){GameType=gamemode[0];var e=selectComplex("4-1","10-7","SkipStack",[".preview",".prev",".next",".flipcard.modeselector"]);game=new Phaser.Game(Editor_Width,Editor_Height,Phaser.CANVAS,"SkipStack",{preload:preload,create:create,update:update,render:render,maxWidth:7*cellSize,maxHeight:7*cellSize}),e.children(".back").attr("id","SkipStack"),genBar("#SkipStack"),flip(e.not(".SkipStack>*")),setTimeout(function(){FlipcardtoArea(e)},1e3)}function createPlayButton(){createButton("7-4","play").click(function(){createGame()})}function createTextCont(e,t){var r=$("<div />");return r.css({width:e*cellSize+"px","text-align":"center","font-size":.8*cellSize+"px",position:"fixed",position:"relative",top:"50%",transform:"translateY(-50%)"}),r.text(t),r}function injectText(e,t){var r,i;t.hasClass("back")?(r=t.parent().data("tl"),i=t.parent().data("br")):(r=t.data("tl"),i=t.data("br"));var o=Number(i.split("-")[1])-Number(r.split("-")[1])+1,l=createTextCont(o,e);return l.appendTo(t),t}function createModeSelector(){var e=gridToFlipCard("10-1","10-1","prev"),t=gridToFlipCard("10-7","10-7","next");e.children(".back").css({"box-sizing":"border-box","background-color":"#ffffff",border:border+"px solid rgb(0, 0, 0)"}).click(function(){prevMode()}),t.children(".back").css({"box-sizing":"border-box","background-color":"#ffffff",border:border+"px solid rgb(0, 0, 0)"}).click(function(){nextMode()});var r=gridToFlipCard("10-2","10-6","modeselector").click(function(){createGame()}),i=gridToFlipCard("4-2","7-6","preview");r.children(".back").css({"box-sizing":"border-box","background-color":"#ffffff",border:border+"px solid rgb(0, 0, 0)"}),injectText("Normal",r.children(".back")),i.children(".back").css({"box-sizing":"border-box","background-color":"#ffffff",border:border+"px solid rgb(0, 0, 0)"}),injectText("[Normal preview]",i.children(".back")),setTimeout(function(){e=flip(e)},100),setTimeout(function(){i=flip(i)},200),setTimeout(function(){t=flip(t)},100),r=flip(r),setTimeout(function(){FlipcardtoArea(i),FlipcardtoArea(t),FlipcardtoArea(e)},1e3)}function doubleSelector(e){e.children(".front").remove(),e=e.children(".back");var t=e.clone();t.removeClass("back"),t.addClass("front"),t.css("backface-visibility","hidden"),e.after(t),console.log(t)}function modeIndicator(e){disposable=e,gamemode.forEach(createDiv)}function createDiv(){}function nextMode(){arrayRotate(gamemode,!0),$(".back.modeselector > div").text(gamemode[0]),$(".preview > div").text("["+gamemode[0]+" preview]")}function prevMode(){arrayRotate(gamemode),$(".back.modeselector > div").text(gamemode[0]),$(".preview > div").text("["+gamemode[0]+" preview]")}function addScript(e){$.getScript(e,function(){return console.log("loaded "+e),!1})}function zIndex(){return uniz+=1}function arrayRotate(e,t){return t?e.push(e.shift()):e.unshift(e.pop()),e}function getCoords(e){return[Number(e.split("-")[0]),Number(e.split("-")[1])]}function updateUi(){recalcBar()}function gridToFlipCard(e,t,r){var i=hashId(),o=hashId(),l=hashId(),s=(Number(e.split("-")[0])-1)*cellSize,c=(Number(e.split("-")[1])-1)*cellSize,a=roundUp(e,t,i);a.addClass("front"),a.addClass(r),a.addClass(l),redGrid(a,s,c);var n=createArea(e,t,o),d=n.css("width"),h=n.css("height");redArea(n,s,c),n.css("background-color","aqua"),n.addClass("back"),n.addClass(r),n.addClass(l),a.css({top:s,left:c,width:d,height:h});var m=$("<div />");return m.css({position:"absolute",top:s+"px",left:c+"px",width:d,height:h,"z-index":zIndex()}),m.addClass("flipcard "+r),m.attr({"data-tl":e,"data-br":t}),$("."+l).wrapAll(m),$("."+r+" > *").removeClass(i),$("."+r+" > *").removeClass(o),$("."+r+" > *").removeClass(l),$(".flipcard."+r)}function FlipcardtoArea(e){e.children(".front").remove();var t=e.css("top"),r=e.css("left"),i=e.data("tl"),o=e.data("br");return e=e.children(".back"),e.attr({"data-tl":i,"data-br":o}),e.css({top:t,left:r,"z-index":zIndex()}),e.unwrap(),e.removeClass("back"),e}function areaToGrid(e){regrid=reGrid(e);var t=regrid.wrap,r=regrid.wraphash;delete regrid,t.addClass("back");var i=hashId(),o=$("."+e);o.addClass(i),o.addClass("front"),tl=o.data("tl");var l=(tl.split("-")[0]-1)*cellSize,s=(tl.split("-")[1]-1)*cellSize;delete tl,redGrid(t,l,s),redArea(o,l,s);var c=$("<div />");c.css({position:"absolute",top:l+"px",left:s+"px",width:o.css("width"),height:o.css("height"),"z-index":zIndex()}),c.addClass("flipcard "+e),c.attr({"data-tl":o.data("tl"),"data-br":o.data("br")});var a=$("."+i+" , ."+r).wrapAll(c);return a}function FlipcardtoGrid(e){e.children(".front").remove();{var t=Number(e.css("top").split("px")[0]),r=Number(e.css("left").split("px")[0]);e.data("tl"),e.data("br")}e=e.children(".back"),deGrid(e,t,r),e.unwrap();var i=e.children();i.unwrap()}function gridBuilder(e,t){for(var r=$(""),i=Number(e.split("-")[0])-1,o=Number(e.split("-")[1])-1,l=Number(t.split("-")[0]),s=Number(t.split("-")[1]);l>i;i++)r=rowCreator(i,o,s,r);return r}function rowCreator(e,t,r,i){for(var o,l,s;r>t;t++)s=cellSize*e,l=cellSize*t,o=$('<div class="cell" id="'+Number(e+1)+"-"+Number(t+1)+'" />'),o.css("left",l),o.css("top",s),$(".gamecont").append(o),i=i.add("#"+Number(e+1)+"-"+Number(t+1));return i}function prepCell(){$(".cell").css("border",border+"px solid #bbb"),$(".cell").css("width",cellSize),$(".cell").css("height",cellSize)}function prepGame(){prepCell(),$(".gamecont").css("border",border+"px solid #bbb"),$(".gamecont").css("width",7*cellSize),$(".gamecont").css("height",13*cellSize)}function compareSize(){var e,t=Math.floor(wwidth/7),r=Math.floor(wheight/13);e=t>r?r:t,cellSize=e-1,border=Math.floor(.00781634663*wheight/2)}function genBar(e){var t=$("<div />"),r=$("<div />"),i=$("<div />");i.css({width:"100%",position:"absolute",height:cellSize/4,bottom:0-cellSize/4,left:"0","z-index":129,"border-left":2*border+"px solid rgb(51, 51, 51)","border-right":2*border+"px solid rgb(51, 51, 51)","border-bottom":2*border+"px solid rgb(51, 51, 51)","box-sizing":"border-box"}),r.css({"background-color":"rgb(255, 255, 255)",width:"100%",position:"absolute",height:cellSize/4,bottom:0-cellSize/4,left:"0","z-index":127}),t.addClass("bar"),t.css({"background-color":"rgb(0, 128, 0)",width:"100%",position:"absolute",height:cellSize/4,bottom:0-cellSize/4,left:"0","z-index":128}),t.appendTo($(e)),r.appendTo($(e)),i.appendTo($(e))}function createArea(e,t,r){var i=Number(e.split("-")[0]),o=Number(e.split("-")[1]),l=Number(t.split("-")[1])-o,s=Number(t.split("-")[0])-i,c=$("<div />");return c.css({position:"absolute",width:(l+1)*cellSize,height:(s+1)*cellSize,top:(i-1)*cellSize,left:(o-1)*cellSize}),$(".gamecont").append(c.addClass(r)),$("."+r)}function createButton(e,t){var r=$('<div class="'+t+'"></div>');return $("#"+e).css("border-color","#000").append(r),$("#"+e)}function reGrid(e){var t=$("."+e),r=t.data("tl"),i=t.data("br"),o=hashId(),l=gridBuilder(r,i),s=Number(r.split("-")[0]),c=Number(r.split("-")[1]),a=Number(i.split("-")[0]),n=Number(i.split("-")[1]),d=$("<div />");d.addClass(o),d.css("width",(n-c+1)*cellSize)+"px",d.css("height",(a-s+1)*cellSize)+"px";var h=l.wrapAll(d);return h.css({border:border+"px solid #bbb",width:cellSize,height:cellSize}),{wrap:$("."+o),wraphash:o}}function createBlock(){var e=$("<div />"),t=Math.floor(2.5*cellSize);e.css({"background-color":"#ffffff",border:2*border+"px solid #000000",width:t+"px",height:t+"px","z-index":10*zIndex(),"-webkit-box-shadow":"0px 0px 25px 3px rgba(0,0,0,0.51)","-moz-box-shadow":"0px 0px 25px 3px rgba(0,0,0,0.51)","box-shadow":"0px 0px 25px 3px rgba(0,0,0,0.51)"});var r=hashId();return e.addClass(r+" center"),e.appendTo("body"),{block:e,hash:r}}function uiCell(e,t,r,i){this.size=e,this.left=t,this.content=r,this.text=i,this.generate=function(){this.tl=getCoords(this.left),this.br=[this.tl[0],this.tl[1]+this.size],this["class"]="cls_"+this.text,this.flipcard=gridToFlipCard(this.tl[0]+"-"+this.tl[1],this.br[0]+"-"+this.br[1],this["class"]),this.area=this.flipcard.children(".back"),this.area.css({"background-color":"#ffffff",border:border+"px solid #000000","box-sizing":"border-box"}),injectText(this.text,this.area),this.flip=function(){flip(this.flipcard)}}}function mouseDragStart(){return game.input.activePointer.withinGame===!1?null:(onDownPosX=game.input.x,void(onDownPosY=game.input.y))}function mouseDragMove(){}function mouseDragEnd(){if(game.input.activePointer.withinGame===!1)return null;onEndPosX=game.input.x,onEndPosY=game.input.y;var e=onDownPosX-onEndPosX,t=onDownPosY-onEndPosY,r=Math.abs(e)>Editor_Width/4,i=Math.abs(t)>Editor_Width/4;(1==r||1==i)&&actor.move(1==i?Math.abs(t)>Math.abs(e)?t>0?"top":"bottom":e>0?"left":"right":e>0?"left":"right"),onDownPosX=onEndPosX=onDownPosY=onEndPosY=0}function getRandom(){return Math.random()}function getRandomArbitrary(e,t){return Math.random()*(t-e)+e}function getRandomInt(e,t){return Math.floor(Math.random()*(t-e))+e}function preload(){enemy=new Array,enemyMove=new Array,movesHaveBeenStored=!1,cellWidth=(Editor_Width-(2*border*cellsCntX+2*border))/cellsCntX,cellHeight=(Editor_Width-(2*border*cellsCntY+2*border))/cellsCntY}function create(){if(!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(cursors=game.input.keyboard.createCursorKeys(),cursors.left.onDown.add(function(){actor.move("left")},this),cursors.right.onDown.add(function(){actor.move("right")},this),cursors.down.onDown.add(function(){actor.move("bottom")},this),cursors.up.onDown.add(function(){actor.move("top")},this),isMultiplayerEnabled)){var e=new Array(87,65,68,83),t=new Array("up","left","right","down");WASDcursor=game.input.keyboard.addKeys(e,t),WASDcursor.up.onDown.add(function(){actor1.move("top")},this),WASDcursor.left.onDown.add(function(){actor1.move("left")},this),WASDcursor.right.onDown.add(function(){actor1.move("right")},this),WASDcursor.down.onDown.add(function(){actor1.move("bottom")},this)}if(game.input.onDown.add(mouseDragStart,this),game.input.onUp.add(mouseDragEnd,this),color=new Color,grid=new Grid(cellsCntX,cellsCntY,cellWidth,cellHeight,"#333","#ffffff",2*border),grid.init(),isMultiplayerEnabled)actor=new Actor("#006400","0-"+Math.floor(cellsCntY/2)),actor1=new Actor("#006400",cellsCntX-1+"-"+Math.ceil(cellsCntY/2)),actor.init(),actor1.init();else{if(justLost===!0)actor=new Actor("#006400");else{var r=actor._c;actor=new Actor("#006400",grid.cell[r].HashId)}actor.init()}if(!isMultiplayerEnabled){for(var i=0;3+gameStateRestarts>i;i++){var o="";o=1==randomBoolean[0]()?1==randomBoolean[0]()?"0-"+getRandomInt(0,cellsCntY):getRandomInt(0,cellsCntX)+"-0":1==randomBoolean[0]()?cellsCntX-1+"-"+getRandomInt(0,cellsCntY):getRandomInt(0,cellsCntX)+"-"+(cellsCntY-1),"Normal"===grid.cell[grid.getCell(o)].type?enemy.push(new Enemy(enemiesColor,o)):i--}for(var o=0;o<enemy.length;o++)enemy[o].init()}EnemyMoveTimeout=game.time.time+beatRate,justLost=justExpandedGrid=!1,LoadTime=game.time.now}function update(){if(game.time.time>EnemyMoveTimeout){for(var e=0;e<enemy.length;e++)enemy[e].move(enemyMove[e]);movesHaveBeenStored=!1,EnemyMoveTimeout=game.time.time+beatRate}else if(movesHaveBeenStored===!1){enemyMove=new Array;for(var t=0;t<enemy.length;t++)enemyMove.push(enemy[t].Nextmove());movesHaveBeenStored=!0}if(!isMultiplayerEnabled)if("Normal"===GameType||"Endless"===GameType)0===enemy.length&&expand();else if("SkipSmash"===GameType)1===enemy.length&&expand();else if("PaintStack"===GameType)if(Math.floor(actor.markedArea)>70)expand();else if(0===enemy.length){for(var e=0;e<Math.ceil((gameStateRestarts+1)/2);e++){var t="";t=1==randomBoolean[0]()?1==randomBoolean[0]()?"0-"+getRandomInt(0,cellsCntY):getRandomInt(0,cellsCntX)+"-0":1==randomBoolean[0]()?cellsCntX-1+"-"+getRandomInt(0,cellsCntY):getRandomInt(0,cellsCntX)+"-"+(cellsCntY-1),"Normal"===grid.cell[grid.getCell(t)].type?enemy.push(new Enemy(enemiesColor,t)):e--}for(var t=0;t<enemy.length;t++)enemy[t].init()}beatInterval=Math.round((EnemyMoveTimeout-game.time.time)/beatRate*100),timeSinceLevelLoad=Math.round((game.time.now-LoadTime)/1e3),updateUi()}function recalcBar(){var e=$(".bar");beatInterval%20===0&&e.css("background-color","rgb("+255*(100-beatInterval)/100+", "+255*beatInterval/100+", 0)"),e.css("width",beatInterval+"%")}function render(){grid.render(),game.debug.text("grid: "+cellsCntX+"-"+cellsCntY,3,14,"#b1ff00"),game.debug.text("enemies: "+enemy.length,3,27,"#b1ff00"),game.debug.text("beat rate: "+beatRate+" ms",3,40,"#b1ff00"),game.debug.text("Interval: "+beatInterval+" %",3,53,20>beatInterval?"#ff0000":"#00ff27"),game.debug.text("time: "+timeSinceLevelLoad+" s",3,66,"#b1ff00"),"PaintStack"===GameType&&game.debug.text("marked area: "+Math.floor(actor.markedArea)+"%",3,79,"#b1ff00")}function gameOver(){justLost=!0,cellsCntY=cellsCntX=7,gameStateRestarts=0,game.state.start(game.state.current),LoadTime=game.time.now}function expand(){justExpandedGrid=!0,"Normal"===GameType||"SkipSmash"===GameType?(justLost=!0,gameStateRestarts++,3+gameStateRestarts>Math.ceil(cellsCntX/2)&&(cellsCntY=++cellsCntX),game.state.start(game.state.current)):"Endless"===GameType?(gameStateRestarts++,3+gameStateRestarts>Math.ceil(cellsCntX/1.5)&&(cellsCntY=cellsCntX+=2,justLost=!0),game.state.start(game.state.current)):"PaintStack"===GameType&&(justLost=!0,gameStateRestarts++,3+gameStateRestarts>cellsCntX&&(cellsCntY=++cellsCntX),game.state.start(game.state.current))}function Grid(e,t,r,i,o,l,s){this.c=o,this.c2=l,this.borderThickness="undefined"==typeof s?2:s,this.cellsCountX=e,this.cellsCountY=t,this.cellWidth=r,this.cellHeight=i,this.grid,this.cell=new Array}function Enemy(e,t){this.color=e,"undefined"==typeof t?alert('Error : "blockID" is undefined'):this.block=t,this.isDead=!1,this._c,grid.cell[grid.getCell(this.block)].type="Enemy"}function Color(){this.Color_OceanBlue=10092543,this.Color_SteelBlue=4620980,this.Color_RoyalBlue=4286945,this.Color_Aquamarine=8388564,this.Color_Blue=255,this.Color_BlueViolet=9055202,this.Color_CadetBlue=6266528,this.Color_CornflowerBlue=6591981,this.Color_Cyan=65535,this.Color_DarkBlue=139,this.Color_DarkCyan=35723,this.Color_DodgerBlue=2003199,this.Color_DeepSkyBlue=49151,this.Color_LightSteelBlue=11584734,this.Color_Navy=128,this.Color_PowderBlue=11591910,this.Color_Turquoise=4251856,this.Color_Black=0,this.Color_Violet=15631086,this.Color_Yellow=16776960,this.Color_Tomato=16737095,this.Color_PaleVioletRed=14381203,this.Color_Red=16711680,this.Color_Wheat=16113331,this.Color_AntiqueWhite=16444375,this.Color_White=16777215}function Cell(e,t,r,i){this.color=i,this.positionX=e,this.positionY=t,this.HashId=r,this.rect,this.init(),this.type="Normal",this.isMarked=!1,this.genColor="#000"}function Actor(e,t){this.color=e,this.block="undefined"==typeof t?Math.floor(cellsCntX/2)+"-"+Math.floor(cellsCntX/2):t,this._c,this.enemiesKilled=0,this.markedArea=0}$(document).ready(function(){compareSize(),gridBuilder("1-1","13-7"),prepGame(),createModeSelector()});var wwidth=$(window).width(),wheight=$(window).height(),cellSize,border,uniz=0,gamemode=["Normal","Endless","SkipSmash","PaintStack"],disposable,onDownPosX,onDownPosY,onEndPosX,onEndPosY,randomBoolean=[function(){return Math.random()<.5},function(){return!(Math.random()+.5|0)},function(){return!(+new Date%2)}],isMultiplayerEnabled=!1,GameType,beatRate=1e3,beatInterval=0,EnemyMoveTimeout=0,Editor_Width=7*cellSize,Editor_Height=7*cellSize,aspect_ratio=Editor_Width/Editor_Height,World_bounds_x=Editor_Width,World_bounds_y=Editor_Height,cellsCntX=7,cellsCntY=7,cellWidth,cellHeight,enemiesColor="#b50000",gameStateRestarts=0,color,grid,actor,actor1,enemy,enemyMove,movesHaveBeenStored,LoadTime,timeSinceLevelLoad,game,justLost=!0,justExpandedGrid=!1,cursors,WASDcursor;Grid.prototype.init=function(){var e=this.cellsCountX*this.cellWidth+this.borderThickness*this.cellsCountX+this.borderThickness,t=this.cellsCountY*this.cellHeight+this.borderThickness*this.cellsCountY+this.borderThickness;this.grid=new Phaser.Rectangle((Editor_Width-e)/2,(Editor_Height-t)/2,e,t),t=(Editor_Height-t)/2,e=(Editor_Width-e)/2;for(var r=0;r<this.cellsCountY;r++)for(var i=0;i<this.cellsCountX;i++){var o=e+this.borderThickness*(i+1)+this.cellWidth*i,l=t+this.borderThickness*(r+1)+this.cellHeight*r;this.cell.push(new Cell(o,l,i.toString()+"-"+r.toString(),this.c2))}},Grid.prototype.getCell=function(e){for(var t=0;t<this.cell.length;t++)if(this.cell[t].HashId==e)return t},Grid.prototype.render=function(){game.debug.geom(this.grid,this.c);for(var e=0;e<this.cell.length;e++)this.cell[e].render()},Grid.prototype.getRow=function(e){for(var t=this.cellsCountX,r=0;r<this.cellsCountX;r++){if(t>e)return r;t+=this.cellsCountX}},Grid.prototype.getColumn=function(e){for(var t=0;t<this.cellsCountX;t++)for(var r=0;r<this.cellsCountX;r++)if(e===r+t*this.cellsCountX)return r},Enemy.prototype.init=function(){this._c=grid.getCell(this.block),grid.cell[this._c].setColor(this.color),grid.cell[this._c].setCellType("Enemy")},Enemy.prototype.move=function(e){switch(e){case"top":grid.cell[this._c].checkCell(e,this._c)&&"Enemy"!==grid.cell[this._c-cellsCntX].type&&(grid.cell[this._c].setCellType("Normal"),grid.cell[this._c].setColor(grid.c2),this._c=this._c-cellsCntX,"PaintStack"===GameType&&grid.cell[this._c].isMarked&&(actor.markedArea-=1/(cellsCntX*cellsCntY)*100,grid.cell[this._c].isMarked=!1),grid.cell[this._c].setColor(this.color),grid.cell[this._c].setCellType("Enemy"));break;case"bottom":grid.cell[this._c].checkCell(e,this._c)&&"Enemy"!==grid.cell[this._c+cellsCntX].type&&(grid.cell[this._c].setCellType("Normal"),grid.cell[this._c].setColor(grid.c2),this._c=this._c+cellsCntX,"PaintStack"===GameType&&grid.cell[this._c].isMarked&&(actor.markedArea-=1/(cellsCntX*cellsCntY)*100,grid.cell[this._c].isMarked=!1),grid.cell[this._c].setColor(this.color),grid.cell[this._c].setCellType("Enemy"));break;case"left":grid.cell[this._c].checkCell(e,this._c)&&"Enemy"!==grid.cell[this._c-1].type&&(grid.cell[this._c].setCellType("Normal"),grid.cell[this._c].setColor(grid.c2),this._c=this._c-1,"PaintStack"===GameType&&grid.cell[this._c].isMarked&&(actor.markedArea-=1/(cellsCntX*cellsCntY)*100,grid.cell[this._c].isMarked=!1),grid.cell[this._c].setColor(this.color),grid.cell[this._c].setCellType("Enemy"));break;case"right":grid.cell[this._c].checkCell(e,this._c)&&"Enemy"!==grid.cell[this._c+1].type&&(grid.cell[this._c].setCellType("Normal"),grid.cell[this._c].setColor(grid.c2),this._c=this._c+1,"PaintStack"===GameType&&grid.cell[this._c].isMarked&&(actor.markedArea-=1/(cellsCntX*cellsCntY)*100,grid.cell[this._c].isMarked=!1),grid.cell[this._c].setColor(this.color),grid.cell[this._c].setCellType("Enemy"))}},Enemy.prototype.Nextmove=function(){var e=actor._c-this._c,t=Math.abs(grid.getRow(actor._c)-grid.getRow(this._c));return 0>e?t>0?"top":this._c>actor._c?"left":"right":0!==e?t>0?"bottom":this._c>actor._c?"left":"right":void gameOver()},Enemy.prototype.Thrust=function(e){switch(e){case"top":for(var t=this._c-cellsCntX,r=0;cellsCntX>r&&(t=this._c-cellsCntX,grid.cell[this._c].checkCell(e,this._c));r++){if("Enemy"===grid.cell[t].type)for(var i=0;i<enemy.length;i++)if(enemy[i]._c===t){grid.cell[t].type="Normal",enemy.splice(i,1),enemyMove.splice(i,1);break}this.move(e)}break;case"bottom":for(var t=this._c+cellsCntX,r=0;cellsCntX>r&&(t=this._c+cellsCntX,grid.cell[this._c].checkCell(e,this._c));r++){if("Enemy"===grid.cell[t].type)for(var i=0;i<enemy.length;i++)if(enemy[i]._c===t){grid.cell[t].type="Normal",enemy.splice(i,1),enemyMove.splice(i,1);break}this.move(e)}break;case"left":for(var t=this._c-1,r=0;cellsCntX>r&&(t=this._c-1,grid.cell[this._c].checkCell(e,this._c));r++){if("Enemy"===grid.cell[t].type)for(var i=0;i<enemy.length;i++)if(enemy[i]._c===t){grid.cell[t].type="Normal",enemy.splice(i,1),enemyMove.splice(i,1);break}this.move(e)}break;case"right":for(var t=this._c+1,r=0;cellsCntX>r&&(t=this._c+1,grid.cell[this._c].checkCell(e,this._c));r++){if("Enemy"===grid.cell[t].type)for(var i=0;i<enemy.length;i++)if(enemy[i]._c===t){grid.cell[t].type="Normal",enemy.splice(i,1),enemyMove.splice(i,1);break}this.move(e)}}},Color.prototype.generateHexColor=function(){return"#"+(16777215*(.5+.5*Math.random())<<0).toString(16)},Color.prototype.genetaRGBAColor=function(){return"rgba("+getRandomInt(0,256)+","+getRandomInt(0,256)+","+getRandomInt(0,256)+","+Math.random()+")"},Color.prototype.genetaRGBColor=function(){return"rgba("+getRandomInt(0,256)+","+getRandomInt(0,256)+","+getRandomInt(0,256)+", 1)"},Color.prototype.genetaHSLColor=function(){return"hsl("+getRandomInt(0,256)+",100%,30%)"},Color.prototype.genetaHSLAColor=function(){return"hsl("+getRandomInt(0,256)+",100%,30%,"+Math.random()+")"},Cell.prototype.init=function(){this.rect=new Phaser.Rectangle(this.positionX,this.positionY,grid.cellWidth,grid.cellWidth)},Cell.prototype.setCellType=function(e){"Normal"!=e&&"Enemy"!=e&&"Actor"!=e&&alert('type can only be "Enemy","Normal","Actor"'),this.type=e},Cell.prototype.render=function(){game.debug.geom(this.rect,this.color)},Cell.prototype.setColor=function(e){this.color=e},Cell.prototype.checkCell=function(e,t){var r=!0;switch(e){case"top":r=cellsCntX>t?!1:!0;break;case"bottom":r=t>cellsCntX*grid.cellsCountY-cellsCntX?!1:!0;break;case"left":for(var i=0;cellsCntX>i;i++)t===cellsCntX*i&&(r=!1);if(0==r)break;r=!0;break;case"right":for(var i=0;cellsCntX>i;i++)t===cellsCntX*i-1&&(r=!1);if(0==r)break;r=!0}return r},Actor.prototype.init=function(){this._c=grid.getCell(this.block),grid.cell[this._c].setColor(this.color),grid.cell[this._c].setCellType("Actor")},Actor.prototype.move=function(e){if("SkipSmash"!==GameType)switch(e){case"top":this.makeMove(e,this._c-cellsCntX);break;case"bottom":this.makeMove(e,this._c+cellsCntX);break;case"left":this.makeMove(e,this._c-1);break;case"right":this.makeMove(e,this._c+1)}else switch(e){case"top":this.thrustEnemy(e,this._c-cellsCntX);break;case"bottom":this.thrustEnemy(e,this._c+cellsCntX);break;case"left":this.thrustEnemy(e,this._c-1);break;case"right":this.thrustEnemy(e,this._c+1)}},Actor.prototype.makeMove=function(e,t){if(grid.cell[this._c].checkCell(e,this._c)){if("Enemy"===grid.cell[t].type)for(var r=0;r<enemy.length;r++)if(enemy[r]._c===t){enemy.splice(r,1),enemyMove.splice(r,1);break}grid.cell[this._c].setCellType("Normal"),"PaintStack"!==GameType?(grid.cell[this._c].setColor(grid.c2),this._c=t,grid.cell[this._c].setColor(this.color),grid.cell[this._c].setCellType("Actor")):(grid.cell[this._c].setColor(grid.cell[this._c].isMarked?grid.cell[this._c].genColor:grid.c2),this._c=t,grid.cell[this._c].isMarked||(this.markedArea+=1/(cellsCntX*cellsCntY)*100,grid.cell[this._c].genColor=color.genetaHSLColor(),grid.cell[this._c].isMarked=!0),grid.cell[this._c].setColor(this.color),grid.cell[this._c].setCellType("Actor"))}},Actor.prototype.thrustEnemy=function(e,t){if(grid.cell[this._c].checkCell(e,this._c))if("Enemy"===grid.cell[t].type){for(var r=0;r<enemy.length;r++)if(enemy[r]._c===t){enemy[r].Thrust(e);break}grid.cell[t].checkCell(e,t)&&(grid.cell[this._c].setCellType("Normal"),grid.cell[this._c].setColor(grid.c2),this._c=t,grid.cell[this._c].setColor(this.color),grid.cell[this._c].setCellType("Actor"))}else grid.cell[this._c].setCellType("Normal"),grid.cell[this._c].setColor(grid.c2),this._c=t,grid.cell[this._c].setColor(this.color),grid.cell[this._c].setCellType("Actor")};var blips_sfx=jsfxlib.createWave(["sine",0,.4,0,.092,0,.208,20,286,2400,-.674,0,0,.01,3e-4,0,0,0,0,0,0,0,0,1,0,0,.048,0]);
