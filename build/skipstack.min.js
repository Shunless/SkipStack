function get_loadingCellShader(){return["#define PI 3.14159265359","precision mediump float;uniform float time;uniform vec2 mouse;uniform vec2 resolution;mat2 rotate2d(float _angle){return mat2(cos(_angle),-sin(_angle), sin(_angle),cos(_angle));}vec3 hsv(float h, float s, float v){return mix(vec3(1.0),clamp((abs(fract( h+vec3(3.0, 2.0, 1.0)/3.0)*6.0-3.0)-1.0), 0.0, 1.0),s)*v;}float shape(vec2 p){return abs(p.x)+abs(p.y)-1.0;}void main( void ){vec2 uv=gl_FragCoord.xy/resolution.xy;vec2 pos=uv*2.0-1.0;pos.x *=resolution.x/resolution.y;pos=pos*cos(0.00005)+vec2(pos.y,-pos.x)*sin(0.00005);pos.x +=1.0;pos.y +=1.0;pos=mod(pos*"+cellsCntX+".0, 2.0)-1.0;uv -=vec2(0.5);pos=rotate2d( sin(time)*PI ) * pos;uv +=vec2(0.5);float c=0.05/abs(sin(0.3*shape(3.0*pos)));vec3 col=hsv(fract(0.1*time),1.0,1.0);gl_FragColor=vec4(col*c,1.0);}"]}function get_loadingCellShader2(){return["#define PI 3.14159265359","precision mediump float;uniform float time;uniform vec2 mouse;uniform vec2 resolution;mat2 rotate2d(float _angle){return mat2(cos(_angle),-sin(_angle), sin(_angle),cos(_angle));}float segm( float a, float b, float c, float x ){return smoothstep(a-c,a,x) - smoothstep(b,b+c,x);}vec3 hsv(float h, float s, float v){return mix(vec3(1.0),clamp((abs(fract( h+vec3(3.0, 2.0, 1.0)/3.0)*6.0-3.0)-1.0), 0.0, 1.0),s)*v;}float shape(vec2 p){return mod(length(sin(p.x) - p.xy + sin(p.y) - p.xy) / 9000.0 , length(p) - 2.8 );}void main( void ){vec2 uv=gl_FragCoord.xy/resolution.xy;vec2 pos=uv*2.0-1.0;pos.x *=resolution.x/resolution.y;pos=pos*cos(0.00005)+vec2(pos.y,-pos.x)*sin(0.00005);pos.x +=1.0;pos.y +=1.0;pos=mod(pos*"+cellsCntX+".0, 2.0)-1.0;float c=0.01/abs(sin(0.2*shape((3.0+abs(sin(time)*4.0))*pos)));vec3 col=hsv(fract(uv.x*uv.y+(abs(pow(time,0.94))+1.0)),0.9+sin(time)/10.0,0.5+abs(sin(time))/2.0);gl_FragColor=vec4(1.0-(col-c),1.0);}"]}function get_loadingShader(){return["precision mediump float;uniform float time;uniform vec2 mouse;uniform vec2 resolution;void main( void ){gl_FragColor=vec4( 1.0 );vec2 p=(gl_FragCoord.xy / resolution.xy) * 2.0 - 1.0;vec2 r=vec2(length(p), atan(p.x, p.y));r.y=fract(time+4.*r.x/3.14);if(r.y > .22 && r.x < .9 && r.y < 0.9){gl_FragColor.rg *=vec2(0.7, .8);}}"]}function preload(){console.log("Preload Function"),enemy=enemyMove=[],movesHaveBeenStored=!1,cellWidth=(Editor_Width-(2*border*cellsCntX+2*border))/cellsCntX,cellHeight=(Editor_Width-(2*border*cellsCntY+2*border))/cellsCntY}function create(){console.log("Create Function"),filter=new Phaser.Filter(game,null,get_loadingShader()),filter.setResolution(Editor_Width,Editor_Height);var e=game.add.sprite();if(e.width=Editor_Width,e.height=Editor_Height,e.filters=[filter],!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(cursors=game.input.keyboard.createCursorKeys(),cursors.left.onDown.add(function(){actor.move("left")},this),cursors.right.onDown.add(function(){actor.move("right")},this),cursors.down.onDown.add(function(){actor.move("down")},this),cursors.up.onDown.add(function(){actor.move("up")},this),isMultiplayerEnabled===!0)){var t=[87,65,68,83],r=["up","left","right","down"];WASDcursor=game.input.keyboard.addKeys(t,r),WASDcursor.up.onDown.add(function(){actor1.move("up")},this),WASDcursor.left.onDown.add(function(){actor1.move("left")},this),WASDcursor.right.onDown.add(function(){actor1.move("right")},this),WASDcursor.down.onDown.add(function(){actor1.move("down")},this)}if(SkipStack.firtIteration){SkipStack.isPaused=!0;var i=game.add.text(game.world.centerX/1.15,game.world.centerY/1.3,"5",{font:"Bold "+Editor_Width/5+"px Arial",fill:"#ffffff",align:"center"});setTimeout(function(){i.text="4",setTimeout(function(){i.text="3",setTimeout(function(){i.text="2",setTimeout(function(){i.text="1",setTimeout(function(){i.text="",SkipStack.isPaused=!1,e.destroy()},1e3)},1e3)},1e3)},1e3)},1e3)}if(color=new Color,grid=new Grid(cellsCntX,cellsCntY,cellWidth,cellHeight,"#333","#ffffff",2*border),grid.init(),isMultiplayerEnabled===!0)actor=new Actor("#006400","0-"+Math.floor(cellsCntY/2)),actor1=new Actor("#006400",cellsCntX-1+"-"+Math.ceil(cellsCntY/2)),actor.init(),actor1.init();else{if(justLost===!0)actor=new Actor("#006400");else{var o=actor._c;actor=new Actor("#006400",grid.cell[o].HashId)}actor.init()}if(isMultiplayerEnabled===!1){var l,s="";for(l=0;3+gameStateRestarts>l;l++)s=randomBoolean[0]()===!0?randomBoolean[0]()===!0?"0-"+getRandomInt(0,cellsCntY):getRandomInt(0,cellsCntX)+"-0":randomBoolean[0]()===!0?cellsCntX-1+"-"+getRandomInt(0,cellsCntY):getRandomInt(0,cellsCntX)+"-"+(cellsCntY-1),"Normal"===grid.cell[grid.getCell(s)].type?enemy.push(new Enemy(enemiesColor,s)):l--;for(s=0;s<enemy.length;s++)enemy[s].init()}EnemyMoveTimeout=game.time.time+beatRate,justLost=justExpandedGrid=!1,LoadTime=game.time.now,$("#gamecont").swipe({swipe:function(e,t,r,i,o,l){actor.move(t)},threshold:0})}function update(){if(SkipStack.isPaused)return filter.update();var e,t;if(isfilterEnabled===!0&&filter.update(),grid.render(),game.time.time>EnemyMoveTimeout){for(e=0;e<enemy.length;e++)enemy[e].move(enemyMove[e]);SkipStack.soundsOn&&blips_sfx.play(),movesHaveBeenStored=!1,EnemyMoveTimeout=game.time.time+beatRate}else if(movesHaveBeenStored===!1){for(enemyMove=[],t=0;t<enemy.length;t++)enemyMove.push(enemy[t].Nextmove());movesHaveBeenStored=!0}if(!isMultiplayerEnabled)if("Normal"===GameType||"Endless"===GameType)0===enemy.length&&expand();else if("SkipSmash"===GameType)1===enemy.length&&expand();else if("PaintStack"===GameType)if(Math.floor(actor.markedArea)>70)expand();else if(0===enemy.length){for(e=0;e<Math.ceil((gameStateRestarts+1)/2);e++)t="",t=randomBoolean[0]()===!0?randomBoolean[0]()===!0?"0-"+getRandomInt(0,cellsCntY):getRandomInt(0,cellsCntX)+"-0":randomBoolean[0]()===!0?cellsCntX-1+"-"+getRandomInt(0,cellsCntY):getRandomInt(0,cellsCntX)+"-"+(cellsCntY-1),"Normal"===grid.cell[grid.getCell(t)].type?enemy.push(new Enemy(enemiesColor,t)):e--;for(t=0;t<enemy.length;t++)enemy[t].init()}beatInterval=Math.round((EnemyMoveTimeout-game.time.time)/beatRate*100),timeSinceLevelLoad=Math.round((game.time.now-LoadTime)/1e3),updateUi(),render()}function recalcBar(){var e=$(".bar");beatInterval%20===0&&e.css("background-color","rgb("+255*(100-beatInterval)/100+", "+255*beatInterval/100+", 0)"),e.css("width",beatInterval+"%")}function render(){game.debug.text("grid: "+cellsCntX+"-"+cellsCntY,3,14,"#b1ff00"),game.debug.text("enemies: "+enemy.length,3,27,"#b1ff00"),game.debug.text("beat rate: "+beatRate+" ms",3,40,"#b1ff00"),game.debug.text("Interval: "+beatInterval+" %",3,53,20>beatInterval?"#ff0000":"#00ff27"),game.debug.text("time: "+timeSinceLevelLoad+" s",3,66,"#b1ff00"),game.debug.text("Level: "+SkipStack.CurrentScore,3,79,"#b1ff00"),"PaintStack"===GameType&&game.debug.text("marked area: "+Math.floor(actor.markedArea)+"%",3,92,"#b1ff00")}function gameOver(){console.clear(),justLost=!0,cellsCntY=cellsCntX=7,LoadTime=game.time.now,"Normal"===GameType?SkipStack.TotalScore[0]+=SkipStack.CurrentScore:"SkipSmash"===GameType?SkipStack.TotalScore[2]+=SkipStack.CurrentScore:"Endless"===GameType?SkipStack.TotalScore[1]+=SkipStack.CurrentScore:"PaintStack"===GameType&&(SkipStack.TotalScore[3]+=SkipStack.CurrentScore),SkipStack.CurrentScore=gameStateRestarts=timesExpanded=0,game.state.start(game.state.current)}function expand(){var e=Math.ceil(cellsCntX+timesExpanded*cellsCntX/2);SkipStack.soundsOn&&levelup_sfx[getRandomInt(0,levelup_sfx.length)].play(),justExpandedGrid=!0,SkipStack.CurrentScore=++gameStateRestarts,"Normal"===GameType?(justLost=!0,3+gameStateRestarts>e&&(timesExpanded++,cellsCntY=++cellsCntX)):"SkipSmash"===GameType?(justLost=!0,3+gameStateRestarts>Math.ceil(cellsCntX+timesExpanded*cellsCntX/3)&&(timesExpanded++,cellsCntY=++cellsCntX)):"Endless"===GameType?3+gameStateRestarts>e&&(cellsCntY=cellsCntX+=2,justLost=!0):"PaintStack"===GameType&&(justLost=!0,3+gameStateRestarts>Math.ceil(cellsCntX+timesExpanded*cellsCntX/4)&&(cellsCntY=++cellsCntX)),game.state.start(game.state.current)}function getRandom(){return Math.random()}function getRandomArbitrary(e,t){return Math.random()*(t-e)+e}function getRandomInt(e,t){return Math.floor(Math.random()*(t-e))+e}function mouseDragStart(){return game.input.activePointer.withinGame?(onDownPosX=game.input.x,void(onDownPosY=game.input.y)):void clearvalues()}function mouseDragEnd(){if(!game.input.activePointer.withinGame||0===onDownPosX||0===onDownPosY)return void clearvalues();onEndPosX=game.input.x,onEndPosY=game.input.y;var e=onDownPosX-onEndPosX,t=onDownPosY-onEndPosY;Math.abs(t)>Math.abs(e)?t>0?actor.move("up"):actor.move("down"):e>0?actor.move("left"):actor.move("right"),clearvalues()}function clearvalues(){onDownPosX=onEndPosX=onDownPosY=onEndPosY=0}function gridBuilder(e,t){var r=$(""),i=new extractCoords(e,t);for(i.top--,i.left--;i.top<i.bottom;i.top++)r=rowCreator(i.top,i.left,i.right,r);return r}function rowCreator(e,t,r,i){for(var o,l,s,n=$(".gamecont");r>t;t++)s=cellSize*e,l=cellSize*t,o=$('<div class="cell" id="'+Number(e+1)+"-"+Number(t+1)+'" />'),o.css({left:l,top:s}),n.append(o),i=i.add("#"+Number(e+1)+"-"+Number(t+1));return i}function prepCell(e,t){var r=new extractCoords(e,t);for(x=r.top;x<=r.bottom;x++)for(y=r.left;y<=r.right;y++)$(".cell#"+x+"-"+y).css({border:border+"px solid #bbb",width:cellSize,height:cellSize})}function compareSize(){var e,t=$(window).height(),r=$(window).height(),i=Math.floor(r/7),o=Math.floor(t/13);i>o?(e=o,border=Math.floor(.00781634663*t/2)):(e=i,border=Math.floor(.00781634663*r/2)),cellSize=e-1,Editor_Height=Editor_Width=7*cellSize}function genBar(e){this.bar=$("<div />"),this.barbg=$("<div />"),this.barfg=$("<div />"),this.barfg.css({width:"100%",position:"absolute",height:cellSize/4,bottom:0-cellSize/4,left:"0","z-index":129,"border-left":2*border+"px solid rgb(0, 0, 0)","border-right":2*border+"px solid rgb(0, 0, 0)","border-bottom":2*border+"px solid rgb(0, 0, 0)","box-sizing":"border-box"}),this.barbg.css({"background-color":"rgb(255, 255, 255)",width:"100%",position:"absolute",height:cellSize/4,bottom:0-cellSize/4,left:"0","z-index":127}),this.bar.addClass("bar"),this.bar.css({"background-color":"rgb(0, 128, 0)",width:"100%",position:"absolute",height:cellSize/4,bottom:0-cellSize/4,left:"0","z-index":128}),this.bar.appendTo($(e)),this.barbg.appendTo($(e)),this.barfg.appendTo($(e))}function createArea(e,t,r){var i=Number(e.split("-")[0]),o=Number(e.split("-")[1]),l=Number(t.split("-")[1])-o,s=Number(t.split("-")[0])-i,n=$("<div />");return n.css({position:"absolute",width:(l+1)*cellSize,height:(s+1)*cellSize,top:(i-1)*cellSize,left:(o-1)*cellSize}),$(".gamecont").append(n.addClass(r)),$("."+r)}function createButton(e,t){var r=$('<div class="'+t+'"></div>');return $("#"+e).css("border-color","#000").append(r),$("#"+e)}function reGrid(e){var t=$("."+e),r=t.data("tl"),i=t.data("br"),o=hashId(),l=gridBuilder(r,i),s=Number(r.split("-")[0]),n=Number(r.split("-")[1]),a=Number(i.split("-")[0]),c=Number(i.split("-")[1]),d=$("<div />");d.addClass(o),d.css("width",(c-n+1)*cellSize+"px"),d.css("height",(a-s+1)*cellSize+"px");var h=l.wrapAll(d);return h.css({border:border+"px solid #bbb",width:cellSize,height:cellSize}),{wrap:$("."+o),wraphash:o}}function createBlock(){var e=$("<div />"),t=Math.floor(2.5*cellSize);e.css({"background-color":"#ffffff",border:2*border+"px solid #000000",width:t+"px",height:t+"px","z-index":10*zIndex(),"-webkit-box-shadow":"0px 0px 25px 3px rgba(0,0,0,0.51)","-moz-box-shadow":"0px 0px 25px 3px rgba(0,0,0,0.51)","box-shadow":"0px 0px 25px 3px rgba(0,0,0,0.51)"});var r=hashId();return e.addClass(r+" center"),e.appendTo("body"),{block:e,hash:r}}function uiCell(e,t,r,i,o){this.size=e,this.left=t,this.content=r,this.text=i,this.rendered=!1,this.generate=function(){this.rendered=!0,this.tl=getCoords(this.left),this.br=[this.tl[0],this.tl[1]+(this.size-1)],this["class"]="cls_"+this.text,this.flipcard=gridToFlipCard(this.tl[0]+"-"+this.tl[1],this.br[0]+"-"+this.br[1],this["class"]),this.area=this.flipcard.children(".back"),this.area.css({"background-color":"#ffffff",border:border+"px solid #000000","box-sizing":"border-box"}),injectText(this.text,this.area),this.text=function(e){return void 0!==e&&this.area.children("div").text(e),this.area.children("div").text()},this.refresh=function(){this.rendered&&this.text(o())},this.flip=function(){flip(this.flipcard)}}}function vibCreate(e,t,r){this.obj=$("."+e),this.obj.jrumble(t),this.vibStart=function(){this.obj.trigger("startRumble")},this.vibStop=function(){this.obj.trigger("stopRumble")},r&&(this.shVib=function(){this.vibStart(),console.log(this),setTimeout(this.vibStop,r)})}function gridToFlipCard(e,t,r){var i=hashId(),o=hashId(),l=hashId(),s=(Number(e.split("-")[0])-1)*cellSize,n=(Number(e.split("-")[1])-1)*cellSize,a=roundUp(e,t,i);a.addClass("front"),a.addClass(r),a.addClass(l),redGrid(a,s,n);var c=createArea(e,t,o),d=c.css("width"),h=c.css("height");redArea(c,s,n),c.css("background-color","aqua"),c.addClass("back"),c.addClass(r),c.addClass(l),a.css({top:s,left:n,width:d,height:h});var p=$("<div />");return p.css({position:"absolute",top:s+"px",left:n+"px",width:d,height:h,"z-index":zIndex()}),p.addClass("flipcard "+r),p.attr({"data-tl":e,"data-br":t}),$("."+l).wrapAll(p),$("."+r+" > *").removeClass(i),$("."+r+" > *").removeClass(o),$("."+r+" > *").removeClass(l),$(".flipcard."+r)}function FlipcardtoArea(e,t){e.children(".front").remove();var r=e.css("top"),i=e.css("left"),o=e.data("tl"),l=e.data("br");return e=e.children(".back"),e.attr({"data-tl":o,"data-br":l}),e.css({top:r,left:i,"z-index":zIndex()}),e.children(".back").removeClass("back"),e.unwrap(),void 0!==t&&(disp=e,t()),e}function areaToGrid(e){var t=reGrid(e),r=t.wrap,i=t.wraphash;r.addClass("back");var o=hashId(),l=$("."+e);l.addClass(o),l.addClass("front");var s=l.data("tl"),n=(s.split("-")[0]-1)*cellSize,a=(s.split("-")[1]-1)*cellSize;redGrid(r,n,a),redArea(l,n,a);var c=$("<div />");c.css({position:"absolute",top:n+"px",left:a+"px",width:l.css("width"),height:l.css("height"),"z-index":zIndex()}),c.addClass("flipcard "+e),c.attr({"data-tl":l.data("tl"),"data-br":l.data("br")});var d=$("."+o+" , ."+i).wrapAll(c);return d}function FlipcardtoGrid(e){e.children(".front").remove();var t=Number(e.css("top").split("px")[0]),r=Number(e.css("left").split("px")[0]);e.data("tl"),e.data("br");e=e.children(".back"),deGrid(e,t,r),e.unwrap();var i=e.children();i.unwrap()}function doubleAreaFlipcard(e,t){var r=$("<div />"),i=$("<div />");r.css({position:"absolute",top:e.css("top"),left:e.css("left"),width:e.css("width"),height:e.css("height"),"z-index":zIndex()}),r.addClass("flipcard "+t),r.attr({"data-tl":e.data("tl"),"data-br":e.data("br"),"data-face":"front"}),e.addClass("front"),e.removeClass("back"),e.css({top:"0",left:"0"}),i.attr("style",e.attr("style")),i.css("backface-visibility","hidden"),i.addClass("back "+t),i.insertAfter(e);$("."+t).wrapAll(r);return $("."+t).not(".back, .front")}function addScript(e){$.getScript(e,function(){console.log("loaded "+e)})}function zIndex(){return uniz+=1}function arrayRotate(e,t){return t?e.push(e.shift()):e.unshift(e.pop()),e}function getCoords(e){return[Number(e.split("-")[0]),Number(e.split("-")[1])]}function updateUi(){recalcBar(),indicator.refresh()}function extractCoords(e,t){this.top=getCoords(e)[0],this.left=getCoords(e)[1],this.bottom=getCoords(t)[0],this.right=getCoords(t)[1]}function callbackTrigger(e,t){disp=e,t()}function prepGame(){prepCell("1-1","13-7"),$(".gamecont").css({border:border+"px solid #bbb",width:7*cellSize,height:13*cellSize})}function createGame(e){GameType=gamemode[0],indicator="PaintStack"===gamemode[0]?new uiCell(2,"2-1","enemies","en",function(){return Math.floor(actor.markedArea)+"%"}):new uiCell(2,"2-1","enemies","en",function(){return enemy.length});var t=selectComplex("4-1","10-7","SkipStack",[".preview",".prev",".next",".modeselector"]);t.children(".back").attr("id","SkipStack"),game=new Phaser.Game(Editor_Width,Editor_Height,Phaser.AUTO,"SkipStack",{preload:preload,create:create,update:update,maxWidth:7*cellSize,maxHeight:7*cellSize});genBar("#SkipStack");return"PaintStack"===gamemode[0]&&(indicator.refresh=function(){indicator.rendered&&this.text(Math.floor(actor.markedArea)+"%")}),indicator.generate(),flip(t.not(".SkipStack>*")),setTimeout(function(){FlipcardtoArea(t)},500),setTimeout(function(){indicator.flip()},300),void 0!==e&&e(),t}function createPlayButton(){createButton("7-4","play").click(function(){createGame()})}function createTextCont(e,t){var r=$("<div />");return r.css({width:e*cellSize+"px","text-align":"center","font-size":.8*cellSize+"px",position:"fixed",top:"50%",transform:"translateY(-50%)"}),r.text(t),r}function injectText(e,t){var r,i;t.hasClass("back")?(r=t.parent().data("tl"),i=t.parent().data("br")):(r=t.data("tl"),i=t.data("br"));var o=Number(i.split("-")[1])-Number(r.split("-")[1])+1,l=createTextCont(o,e);return l.appendTo(t),t}function createModeSelector(){var e=gridToFlipCard("10-1","10-1","prev"),t=gridToFlipCard("10-7","10-7","next");e.children(".back").css({"box-sizing":"border-box","background-color":"#ffffff",border:border+"px solid rgb(0, 0, 0)"}).click(function(){prevMode()}),t.children(".back").css({"box-sizing":"border-box","background-color":"#ffffff",border:border+"px solid rgb(0, 0, 0)"}).click(function(){nextMode()});var r=gridToFlipCard("10-2","10-6","modeselector"),i=gridToFlipCard("4-2","7-6","preview");r.children(".back").css({"box-sizing":"border-box","background-color":"#ffffff",border:border+"px solid rgb(0, 0, 0)"}),injectText("Normal",r.children(".back")),i.children(".back").css({"box-sizing":"border-box","background-color":"#ffffff",border:border+"px solid rgb(0, 0, 0)"}),injectText("[Normal preview]",i.children(".back")),setTimeout(function(){e=flip(e)},100),setTimeout(function(){i=flip(i)},200),setTimeout(function(){t=flip(t)},100),r=flip(r),setTimeout(function(){r=FlipcardtoArea(r,handleGameCreate),i=FlipcardtoArea(i,handlePreview),t=FlipcardtoArea(t),e=FlipcardtoArea(e)},1e3)}function handlePreview(){disp=doubleAreaFlipcard(disp,"preview"),injectText("disp",disp.children(".back"))}function handleGameCreate(){disp=doubleAreaFlipcard(disp,"modeselector"),injectText("disp",disp.children(".back")),disp.click(function(){createGame()})}function flipSelector(e,t,r){"front"==e.data("face")?(e.data("face","back"),e.children(".back > div").text(t)):(e.data("face","front"),e.children(".front > div").text(t)),flip(e.not(".flipcard > *"),r)}function nextMode(){arrayRotate(gamemode,!0),setTimeout(function(){flipSelector($(".preview"),"["+gamemode[0]+" preview]")},50),flipSelector($(".modeselector"),gamemode[0])}function prevMode(){arrayRotate(gamemode),setTimeout(function(){flipSelector($(".preview"),"["+gamemode[0]+" preview]",!0)},50),flipSelector($(".modeselector"),gamemode[0],!0)}function selectCell(e){var t=e.split("-")[0],r=e.split("-")[1];return $("#"+t+"-"+r)}function selectRow(e){for(var t=1,r=$("");7>=t;t++)r=r.add(selectCell(e+"-"+t));return r}function selectCol(e){for(var t=1,r=$("");13>=t;t++)r=r.add(selectCell(t+"-"+e));return r}function selectAreaComplimentary(e,t,r,i){for(;t+1>=e;e++)i=i.add(selectCell(r+"-"+e));return i}function selectArea(e,t){for(var r=$(""),i=Number(e.split("-")[0]),o=Number(e.split("-")[1]),l=Number(t.split("-")[0]),s=Number(t.split("-")[1])-1;l>=i;i++)r=selectAreaComplimentary(o,s,i,r);return r}function roundUp(e,t,r){return selectArea(e,t).wrapAll('<div class="'+r+'"/>'),$("."+r)}function flip(e,t,r){e.css("z-index",zIndex()),void 0===e.data("rotation")&&e.data("rotation",0);var i,o=e.data("rotation");return t?(i=180*Number(o)-180,o--):(i=180*Number(o)+180,o++),e.transition({perspective:"800px",rotateY:i+"deg"}),e.data("rotation",o),void 0!==r&&r(e,r),e}function hashId(){for(var e="",t="abcdefghijklmnopqrstuvwxyz",r=0;5>r;r++)e+=t.charAt(Math.floor(Math.random()*t.length));return e}function redGrid(e,t,r){return e.children(".cell").each(function(){$(this).css("top",Number($(this).css("top").split("px")[0])-t+"px"),$(this).css("left",Number($(this).css("left").split("px")[0])-r+"px")}),e}function deGrid(e,t,r){return e.children(".cell").each(function(){$(this).css("top",Number($(this).css("top").split("px")[0])+t+"px"),$(this).css("left",Number($(this).css("left").split("px")[0])+r+"px")}),e}function redArea(e,t,r){return e.css({top:Number($(e).css("top").split("px")[0])-t+"px",left:Number($(e).css("left").split("px")[0])-r+"px"}),e}function selectComplex(e,t,r,i){var o=gridToFlipCard(e,t,r),l=$(o.children(".front")),s=getCoords(e);return i.forEach(function(e){redArea($(e),Number(s[0]-1)*cellSize,Number(s[1]-1)*cellSize),l=l.append($(e))}),l.appendTo($("."+r+".front")),o}var shader_loadin0=["#define PI 3.14159265359","precision mediump float;uniform float time;uniform vec2 mouse;uniform vec2 resolution;mat2 rotate2d(float _angle){return mat2(cos(_angle),-sin(_angle), sin(_angle),cos(_angle));}vec3 hsv(float h, float s, float v){return mix(vec3(1.0),clamp((abs(fract( h+vec3(3.0, 2.0, 1.0)/3.0)*6.0-3.0)-1.0), 0.0, 1.0),s)*v;}float shape(vec2 p){return abs(p.x*3.0)+abs(p.y*3.)-1.0-sin(time)*10.0;}void main( void ){vec2 uv=gl_FragCoord.xy/resolution.xy;vec2 pos=uv*2.0-1.0;pos.x *=resolution.x/resolution.y;pos=pos*cos(0.00005)+vec2(pos.y,-pos.x)*sin(0.00005);pos.x +=1.0;pos.y +=1.0;pos=mod(pos*7.0, 2.0)-1.0;uv -=vec2(0.5);pos=rotate2d( sin(0.)*PI ) * pos;uv +=vec2(0.5);float c=0.05/abs(sin(0.3*shape(3.0*pos)));vec3 col=hsv(fract(0.1*time),1.0,1.0);gl_FragColor=vec4(col*c,1.0);}"],blips_sfx=jsfxlib.createWave(["sine",0,.4,0,.092,0,.208,20,286,2400,-.674,0,0,.01,3e-4,0,0,0,0,0,0,0,0,1,0,0,.048,0]),hit_sfx=jsfxlib.createWave(["noise",0,.4,0,.25,.486,.434,20,210,2400,0,0,0,.01,3e-4,0,0,0,0,0,0,.568,-.298,1,0,0,0,0]),levelup_sfx=[jsfxlib.createWave(["square",0,.4,.672,1.424,.351,1.526,636,2166,1208,-.268,.08,.132,35.9545,.6126,-.024,-.948,.757,.0435,.586,.3992,-.974,-.434,.802,-.156,.526,.792,.572]),jsfxlib.createWave(["square",0,.4,.242,1.174,2.097,.946,1529,139,1995,-.206,.884,.769,3.7532,.6438,-.966,-.786,.419,.383,.482,.1912,-.904,-.082,.624,-.568,.015,.345,.26]),jsfxlib.createWave(["synth",0,.4,.082,1.742,2.637,.658,1661,2057,69,.886,.402,.188,17.6703,.9337,.38,-.09,.222,.1315,-.774,.1648,-.16,-.408,.439,-.358,.884,.906,-.1])];Actor=function(e,t){this.color=e,"undefined"==typeof t?this.block=Math.floor(cellsCntX/2)+"-"+Math.floor(cellsCntX/2):this.block=t,this._c=0,this.enemiesKilled=0,this.markedArea=0},Actor.prototype={init:function(){this._c=grid.getCell(this.block),grid.cell[this._c].setColor(this.color),grid.cell[this._c].setCellType("Actor")},move:function(e){if("SkipSmash"!==GameType)switch(e){case"up":this.makeMove(e,this._c-cellsCntX);break;case"down":this.makeMove(e,this._c+cellsCntX);break;case"left":this.makeMove(e,this._c-1);break;case"right":this.makeMove(e,this._c+1)}else switch(e){case"up":this.thrustEnemy(e,this._c-cellsCntX);break;case"down":this.thrustEnemy(e,this._c+cellsCntX);break;case"left":this.thrustEnemy(e,this._c-1);break;case"right":this.thrustEnemy(e,this._c+1)}},makeMove:function(e,t){if(grid.cell[this._c].checkCell(e,this._c)){if("Enemy"===grid.cell[t].type)for(var r=0;r<enemy.length;r++)if(enemy[r]._c===t){0!=enemy.length&&SkipStack.soundsOn&&hit_sfx.play(),enemy.splice(r,1),enemyMove.splice(r,1);break}grid.cell[this._c].setCellType("Normal"),"PaintStack"!==GameType?(grid.cell[this._c].setColor(grid.c2),this._c=t,grid.cell[this._c].setColor(this.color),grid.cell[this._c].setCellType("Actor")):(grid.cell[this._c].isMarked?grid.cell[this._c].setColor(grid.cell[this._c].genColor):grid.cell[this._c].setColor(grid.c2),this._c=t,grid.cell[this._c].isMarked||(this.markedArea+=1/(cellsCntX*cellsCntY)*100,grid.cell[this._c].genColor=color.genetaHSLColor_Angle([{minAngle:320,maxAngle:359},{minAngle:0,maxAngle:40},{minAngle:70,maxAngle:160}]),grid.cell[this._c].isMarked=!0),grid.cell[this._c].setColor(this.color),grid.cell[this._c].setCellType("Actor"))}},thrustEnemy:function(e,t){if(grid.cell[this._c].checkCell(e,this._c))if("Enemy"===grid.cell[t].type){for(var r=0;r<enemy.length;r++)if(enemy[r]._c===t){enemy[r].Thrust(e);break}grid.cell[t].checkCell(e,t)&&(grid.cell[this._c].setCellType("Normal"),grid.cell[this._c].setColor(grid.c2),this._c=t,grid.cell[this._c].setColor(this.color),grid.cell[this._c].setCellType("Actor"))}else grid.cell[this._c].setCellType("Normal"),grid.cell[this._c].setColor(grid.c2),this._c=t,grid.cell[this._c].setColor(this.color),grid.cell[this._c].setCellType("Actor")}},Actor.prototype.constructor=Actor,Cell=function(e,t,r,i){this.color=i,this.positionX=e,this.positionY=t,this.HashId=r,this.rect,this.init(),this.type="Normal",this.isMarked=!1,this.isFilterEnabled=!1,this.genColor="#000"},Cell.prototype={init:function(){this.rect=new Phaser.Rectangle(this.positionX,this.positionY,grid.cellWidth,grid.cellWidth)},setCellType:function(e){"Normal"!=e&&"Enemy"!=e&&"Actor"!=e&&alert('type can only be "Enemy","Normal","Actor"'),this.type=e},render:function(){this.isFilterEnabled===!1&&game.debug.geom(this.rect,this.color)},setColor:function(e){this.color=e},EnableFilter:function(){this.isFilterEnabled=!0,this.rect=game.add.sprite(this.positionX,this.positionY),this.rect.width=cellWidth,this.rect.height=cellHeight,this.rect.filters=[filter]},checkCell:function(e,t){var r,i=!0;switch(e){case"up":i=cellsCntX>t?!1:!0;break;case"down":i=t>cellsCntX*grid.cellsCountY-cellsCntX?!1:!0;break;case"left":for(r=0;cellsCntX>r;r++)t===cellsCntX*r&&(i=!1);if(i===!1)break;i=!0;break;case"right":for(r=0;cellsCntX>r;r++)t===cellsCntX*r-1&&(i=!1);if(i===!1)break;i=!0}return i}},Cell.prototype.constructor=Cell,Color=function(){this.Color_OceanBlue=10092543,this.Color_SteelBlue=4620980,this.Color_RoyalBlue=4286945,this.Color_Aquamarine=8388564,this.Color_Blue=255,this.Color_BlueViolet=9055202,this.Color_CadetBlue=6266528,this.Color_CornflowerBlue=6591981,this.Color_Cyan=65535,this.Color_DarkBlue=139,this.Color_DarkCyan=35723,this.Color_DodgerBlue=2003199,this.Color_DeepSkyBlue=49151,this.Color_LightSteelBlue=11584734,this.Color_Navy=128,this.Color_PowderBlue=11591910,this.Color_Turquoise=4251856,this.Color_Black=0,this.Color_Violet=15631086,this.Color_Yellow=16776960,this.Color_Tomato=16737095,this.Color_PaleVioletRed=14381203,this.Color_Red=16711680,this.Color_Wheat=16113331,this.Color_AntiqueWhite=16444375,this.Color_White=16777215},Color.prototype={generateHexColor:function(){return"#"+(16777215*(.5+.5*Math.random())<<0).toString(16)},genetaRGBAColor:function(){return"rgba("+getRandomInt(0,256)+","+getRandomInt(0,256)+","+getRandomInt(0,256)+","+Math.random()+")"},genetaRGBColor_max:function(e,t,r){for(var i=[getRandomInt(0,256),getRandomInt(0,256),getRandomInt(0,256)];i[0]>e;)i[0]/=2;for(;i[1]>e;)i[1]/=2;for(;i[2]>e;)i[2]/=2;return"rgba("+Math.round(i[0])+","+Math.round(i[1])+","+Math.round(i[2])+", 1)"},genetaRGBColor:function(){return"rgba("+getRandomInt(0,256)+","+getRandomInt(0,256)+","+getRandomInt(0,256)+", 1)"},genetaHSLColor:function(){return"hsl("+getRandomInt(0,360)+",30%,30%)"},genetaHSLColor_Angle:function(e){for(var t=0,r=getRandomInt(0,360);t<e.length;)r>=e[t].minAngle&&r<=e[t].maxAngle&&(r=getRandomInt(0,360),t=-1),t++;return"hsl("+r+","+getRandomInt(30,61)+"%,30%)"},genetaHSLAColor:function(){return"hsl("+getRandomInt(0,360)+",30%,30%,"+Math.random()+")"}},Color.prototype.constructor=Color,Enemy=function(e,t){this.color=e,"undefined"==typeof t?alert('Error : "blockID" is undefined'):this.block=t,this.isDead=!1,this._c=0,grid.cell[grid.getCell(this.block)].type="Enemy"},Enemy.prototype={init:function(){this._c=grid.getCell(this.block),grid.cell[this._c].setColor(this.color),grid.cell[this._c].setCellType("Enemy")},move:function(e){switch(e){case"up":grid.cell[this._c].checkCell(e,this._c)&&"Enemy"!==grid.cell[this._c-cellsCntX].type&&(grid.cell[this._c].setCellType("Normal"),grid.cell[this._c].setColor(grid.c2),this._c=this._c-cellsCntX,"PaintStack"===GameType&&grid.cell[this._c].isMarked&&(actor.markedArea-=1/(cellsCntX*cellsCntY)*100,grid.cell[this._c].isMarked=!1),grid.cell[this._c].setColor(this.color),grid.cell[this._c].setCellType("Enemy"));break;case"down":grid.cell[this._c].checkCell(e,this._c)&&"Enemy"!==grid.cell[this._c+cellsCntX].type&&(grid.cell[this._c].setCellType("Normal"),grid.cell[this._c].setColor(grid.c2),this._c=this._c+cellsCntX,"PaintStack"===GameType&&grid.cell[this._c].isMarked&&(actor.markedArea-=1/(cellsCntX*cellsCntY)*100,grid.cell[this._c].isMarked=!1),grid.cell[this._c].setColor(this.color),grid.cell[this._c].setCellType("Enemy"));break;case"left":grid.cell[this._c].checkCell(e,this._c)&&"Enemy"!==grid.cell[this._c-1].type&&(grid.cell[this._c].setCellType("Normal"),grid.cell[this._c].setColor(grid.c2),this._c=this._c-1,"PaintStack"===GameType&&grid.cell[this._c].isMarked&&(actor.markedArea-=1/(cellsCntX*cellsCntY)*100,grid.cell[this._c].isMarked=!1),grid.cell[this._c].setColor(this.color),grid.cell[this._c].setCellType("Enemy"));break;case"right":grid.cell[this._c].checkCell(e,this._c)&&"Enemy"!==grid.cell[this._c+1].type&&(grid.cell[this._c].setCellType("Normal"),grid.cell[this._c].setColor(grid.c2),this._c=this._c+1,"PaintStack"===GameType&&grid.cell[this._c].isMarked&&(actor.markedArea-=1/(cellsCntX*cellsCntY)*100,grid.cell[this._c].isMarked=!1),grid.cell[this._c].setColor(this.color),grid.cell[this._c].setCellType("Enemy"))}},Nextmove:function(){var e=actor._c-this._c,t=Math.round(grid.getRow(actor._c)-grid.getRow(this._c)),r=Math.round(grid.getColumn(actor._c)-grid.getColumn(this._c));return 0===e?gameOver():t>0&&randomBoolean[0]()===!0?"down":0>t&&randomBoolean[0]()===!0?"up":r>0?"right":"left"},Thrust:function(e){var t,r,i;switch(e){case"up":for(t=this._c-cellsCntX,r=0;cellsCntX>r&&(t=this._c-cellsCntX,grid.cell[this._c].checkCell(e,this._c));r++){if("Enemy"===grid.cell[t].type)for(i=0;i<enemy.length;i++)if(enemy[i]._c===t){grid.cell[t].type="Normal",enemy.splice(i,1),enemyMove.splice(i,1);break}this.move(e)}break;case"down":for(t=this._c+cellsCntX,r=0;cellsCntX>r&&(t=this._c+cellsCntX,grid.cell[this._c].checkCell(e,this._c));r++){if("Enemy"===grid.cell[t].type)for(i=0;i<enemy.length;i++)if(enemy[i]._c===t){grid.cell[t].type="Normal",enemy.splice(i,1),enemyMove.splice(i,1);break}this.move(e)}break;case"left":for(t=this._c-1,r=0;cellsCntX>r&&(t=this._c-1,grid.cell[this._c].checkCell(e,this._c));r++){if("Enemy"===grid.cell[t].type)for(i=0;i<enemy.length;i++)if(enemy[i]._c===t){grid.cell[t].type="Normal",enemy.splice(i,1),enemyMove.splice(i,1);break}this.move(e)}break;case"right":for(t=this._c+1,r=0;cellsCntX>r&&(t=this._c+1,grid.cell[this._c].checkCell(e,this._c));r++){if("Enemy"===grid.cell[t].type)for(i=0;i<enemy.length;i++)if(enemy[i]._c===t){grid.cell[t].type="Normal",enemy.splice(i,1),enemyMove.splice(i,1);break}this.move(e)}}}},Enemy.prototype.constructor=Enemy,Grid=function(e,t,r,i,o,l,s){this.c=o,this.c2=l,"undefined"==typeof s?this.borderThickness=2:this.borderThickness=s,this.cellsCountX=e,this.cellsCountY=t,this.cellWidth=r,this.cellHeight=i,this.grid,this.cell=[]},Grid.prototype={init:function(){var e=this.cellsCountX*this.cellWidth+this.borderThickness*this.cellsCountX+this.borderThickness,t=this.cellsCountY*this.cellHeight+this.borderThickness*this.cellsCountY+this.borderThickness;this.grid=new Phaser.Rectangle((Editor_Width-e)/2,(Editor_Height-t)/2,e,t),t=(Editor_Height-t)/2,e=(Editor_Width-e)/2;for(var r=0;r<this.cellsCountY;r++)for(var i=0;i<this.cellsCountX;i++){var o=e+this.borderThickness*(i+1)+this.cellWidth*i,l=t+this.borderThickness*(r+1)+this.cellHeight*r;this.cell.push(new Cell(o,l,i.toString()+"-"+r.toString(),this.c2))}},getCell:function(e){for(var t=0;t<this.cell.length;t++)if(this.cell[t].HashId==e)return t;return console.log("Couldn't find the cell with id = "+e),-1},render:function(){for(var e=0;e<this.cell.length;e++)this.cell[e].render()},getRow:function(e){for(var t=this.cellsCountX,r=0;r<this.cellsCountX;r++){if(t>e)return r;t+=this.cellsCountX}console.error("Something went terribly wrong! \n Couldn't find the row of a cell.");
},getColumn:function(e){for(var t=0;t<this.cellsCountX;t++)for(var r=0;r<this.cellsCountX;r++)if(e===t+r*this.cellsCountX)return t;console.error("Something went terribly wrong! \n Couldn't find the column of a cell.")}},Grid.prototype.constructor=Grid;var isMultiplayerEnabled=!1,SkipStack=SkipStack||{version:"0.0.1",soundsOn:!0,TotalScore:[0,0,0,0],CurrentScore:0,isPaused:!0,firtIteration:!0},filter,isfilterEnabled=!1,GameType,beatRate=1e3,beatInterval=0,EnemyMoveTimeout=0,cellsCntX=7,cellsCntY=7,cellWidth,cellHeight,enemiesColor="#b50000",gameStateRestarts=0,color,grid,actor,actor1,enemy,enemyMove,movesHaveBeenStored,LoadTime,timeSinceLevelLoad,game,justLost=!0,justExpandedGrid=!1,timesExpanded=0,cursors,WASDcursor,randomBoolean=[function(){return Math.random()<.5},function(){return!(Math.random()+.5|0)},function(){return!(+new Date%2)}],onDownPosX,onDownPosY,onEndPosX,onEndPosY,Editor_Width,Editor_Height,cellSize,border,uniz=0,gamemode=["Normal","Endless","SkipSmash","PaintStack"],disp;$(document).ready(function(){compareSize(),gridBuilder("1-1","13-7"),prepGame(),$("#using_builder").length<=0&&(console.log("Loading Scripts"),addScript("src/Math.js"),addScript("src/Cell.js"),addScript("src/Swipe.js"),addScript("src/Actor.js"),addScript("src/Enemy.js"),addScript("src/Assets/Tunes.js"),addScript("src/Assets/Shaders.js"),addScript("src/Grid.js"),addScript("src/Color.js"),addScript("src/index.js"),console.log("Loaded Scripts")),createModeSelector()});var indicator;
//# sourceMappingURL=skipstack.min.js.map
